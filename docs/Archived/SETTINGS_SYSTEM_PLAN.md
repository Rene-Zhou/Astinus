# Settings ç³»ç»Ÿé‡æ„è®¡åˆ’

> åˆ›å»ºæ—¥æœŸï¼š2026-01-11
> çŠ¶æ€ï¼šå¾…å®ç°
> ç›®æ ‡ï¼šå‰ç«¯è®¾ç½®é¡µé¢ + çµæ´»çš„ Provider/Agent é…ç½®

## ç›®å½•

1. [èƒŒæ™¯ä¸ç›®æ ‡](#èƒŒæ™¯ä¸ç›®æ ‡)
2. [å®‰å…¨è®¾è®¡](#å®‰å…¨è®¾è®¡)
3. [é…ç½®ç»“æ„è®¾è®¡](#é…ç½®ç»“æ„è®¾è®¡)
4. [åç«¯ API è®¾è®¡](#åç«¯-api-è®¾è®¡)
5. [å‰ç«¯è®¾ç½®é¡µé¢è®¾è®¡](#å‰ç«¯è®¾ç½®é¡µé¢è®¾è®¡)
6. [å®ç°ä»»åŠ¡æ¸…å•](#å®ç°ä»»åŠ¡æ¸…å•)
7. [æœªæ¥å¼€å‘é¡¹](#æœªæ¥å¼€å‘é¡¹)

---

## èƒŒæ™¯ä¸ç›®æ ‡

### å½“å‰é—®é¢˜

1. **é…ç½®æ··ä¹±**ï¼šç»è¿‡å¤šè½®ä¿®æ”¹ï¼Œ`config/settings.yaml` ä¸­çš„é…ç½®é¡¹ç»“æ„ä¸æ¸…æ™°
2. **çµæ´»æ€§ä¸è¶³**ï¼šæ— æ³•ä¸ºä¸åŒ Agent é…ç½®ä¸åŒçš„ AI Provider
3. **ç¼ºå°‘å‰ç«¯ç®¡ç†**ï¼šå¿…é¡»æ‰‹åŠ¨ç¼–è¾‘ YAML æ–‡ä»¶ï¼Œæ— å¯è§†åŒ–ç•Œé¢
4. **æ‰©å±•æ€§å·®**ï¼šéš¾ä»¥æ·»åŠ è‡ªå®šä¹‰ Providerï¼ˆå¦‚ä»£ç†æœåŠ¡ã€ç§æœ‰éƒ¨ç½²ï¼‰

### ç›®æ ‡

1. **å‰ç«¯è®¾ç½®é¡µé¢**ï¼šå¯è§†åŒ–ç®¡ç†æ‰€æœ‰ AI é…ç½®
2. **çµæ´»çš„ Provider ç³»ç»Ÿ**ï¼šæ”¯æŒå®šä¹‰å¤šä¸ª Providerï¼Œæ¯ä¸ª Agent ç‹¬ç«‹é€‰æ‹©
3. **è‡ªå®šä¹‰ base_url**ï¼šæ”¯æŒä»£ç†æœåŠ¡ã€ç§æœ‰éƒ¨ç½²
4. **è¿é€šæ€§æµ‹è¯•**ï¼šä¸€é”®æµ‹è¯• API è¿æ¥çŠ¶æ€
5. **é¡¹ç›®çº§é…ç½®**ï¼šæ‰€æœ‰é…ç½®ä¿æŒåœ¨é¡¹ç›®ç›®å½•å†…ï¼Œä¸æ±¡æŸ“ç³»ç»Ÿç¯å¢ƒ

---

## å®‰å…¨è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®‰å…¨è¾¹ç•Œè®¾è®¡                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. API å¯†é’¥åªå­˜åœ¨äºåç«¯ï¼Œå‰ç«¯æ°¸ä¸æŒä¹…åŒ–                        â”‚
â”‚  2. GET è¯·æ±‚è¿”å›æ©ç å¯†é’¥ï¼Œéšè—çœŸå®å€¼                           â”‚
â”‚  3. PUT è¯·æ±‚æ™ºèƒ½åˆ¤æ–­ï¼šæ©ç å€¼=ä¸æ›´æ–°ï¼Œæ–°å€¼=æ›´æ–°                   â”‚
â”‚  4. æµ‹è¯•è¿é€šæ€§åœ¨åç«¯æ‰§è¡Œï¼Œå‰ç«¯åªè§¦å‘                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
å‰ç«¯è®¾ç½®é¡µé¢                    åç«¯ API                    settings.yaml
     â”‚                            â”‚                            â”‚
     â”‚  GET /api/v1/settings      â”‚                            â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  è¯»å– YAML                 â”‚
     â”‚                            â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
     â”‚  è¿”å› (å¯†é’¥æ©ç )            â”‚                            â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚  PUT /api/v1/settings      â”‚                            â”‚
     â”‚  (æ–°å¯†é’¥æˆ–æ©ç å€¼)           â”‚                            â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  æ™ºèƒ½æ›´æ–°                   â”‚
     â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚
     â”‚  è¿”å›æˆåŠŸ                   â”‚                            â”‚
     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                            â”‚
```

### å¯†é’¥å¤„ç†é€»è¾‘

```python
def mask_api_key(key: str | None) -> str:
    """æ©ç  API å¯†é’¥: AIzaSyBxxxxx â†’ AIza****xxx"""
    if not key:
        return ""
    if len(key) <= 8:
        return "****"
    return f"{key[:4]}****{key[-3:]}"

def is_masked(value: str) -> bool:
    """åˆ¤æ–­æ˜¯å¦æ˜¯æ©ç å€¼"""
    return "****" in value

def should_update_key(new_key: str, old_key: str | None) -> str | None:
    """æ™ºèƒ½æ›´æ–°å¯†é’¥"""
    if not new_key:
        return None       # æ¸…ç©ºå¯†é’¥
    if is_masked(new_key):
        return old_key    # æ©ç å€¼ = ä¸æ›´æ–°ï¼Œä¿ç•™åŸå€¼
    return new_key        # æ–°å€¼ = æ›´æ–°
```

---

## é…ç½®ç»“æ„è®¾è®¡

### æ–°çš„ settings.yaml ç»“æ„

```yaml
# config/settings.yaml

# ==========================================
# Provider å®šä¹‰ï¼ˆç”¨æˆ·å¯è‡ªå®šä¹‰å¤šä¸ªï¼‰
# ==========================================
providers:
  # é»˜è®¤ç©º Providerï¼ˆå¼•å¯¼ç”¨æˆ·é…ç½®ï¼‰
  - id: "default"
    name: "Default Provider (æœªé…ç½®)"
    type: "openai"
    api_key: ""
    base_url: null

  # ç”¨æˆ·è‡ªå®šä¹‰ç¤ºä¾‹
  - id: "google-gemini"
    name: "Google Gemini"
    type: "google"
    api_key: "AIzaSyBxxxxx"
    base_url: null

  - id: "openai-proxy"
    name: "OpenAI (ä»£ç†)"
    type: "openai"
    api_key: "sk-xxxxx"
    base_url: "https://api.openai-proxy.com/v1"

  - id: "local-ollama"
    name: "æœ¬åœ° Ollama"
    type: "ollama"
    api_key: null
    base_url: "http://localhost:11434"

# ==========================================
# Agent é…ç½®ï¼ˆæ¯ä¸ª Agent ç‹¬ç«‹é€‰æ‹© Providerï¼‰
# ==========================================
agents:
  gm:
    provider_id: "google-gemini"
    model: "gemini-3-flash-preview"
    temperature: 0.7
    max_tokens: 2048

  npc:
    provider_id: "google-gemini"
    model: "gemini-3-flash-preview"
    temperature: 0.8
    max_tokens: 1024

  rule:
    provider_id: "local-ollama"
    model: "llama3"
    temperature: 0.3
    max_tokens: 512

  lore:
    provider_id: "google-gemini"
    model: "gemini-2.5-flash-lite"
    temperature: 0.5
    max_tokens: 1024

# ==========================================
# å…¶ä»–é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
# ==========================================
database:
  sqlite_path: "data/saves/game.db"
  chromadb_path: "data/vector_store"
  enable_vector_search: true

server:
  host: "127.0.0.1"
  port: 8000
  reload: true
  log_level: "info"

game:
  default_language: "cn"
  packs_directory: "data/packs"
  dice:
    use_advantage_system: true
    show_roll_details: true

logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/astinus.log"
```

### Provider ID éªŒè¯è§„åˆ™

Provider ID å¿…é¡»æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š
- **æ ¼å¼**ï¼šä»…å…è®¸å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦ï¼ˆ`-`ï¼‰
- **æ­£åˆ™**ï¼š`^[a-z0-9][a-z0-9-]*[a-z0-9]$` æˆ– `^[a-z0-9]$`ï¼ˆå•å­—ç¬¦ï¼‰
- **é•¿åº¦**ï¼š2-32 å­—ç¬¦
- **ç¤ºä¾‹**ï¼š
  - âœ… `google-gemini`, `openai-proxy`, `local-1`, `my-api`
  - âŒ `Google Gemini`ï¼ˆå«å¤§å†™å’Œç©ºæ ¼ï¼‰
  - âŒ `æˆ‘çš„API`ï¼ˆå«ä¸­æ–‡ï¼‰
  - âŒ `-start`ï¼ˆä»¥è¿å­—ç¬¦å¼€å¤´ï¼‰
  - âŒ `end-`ï¼ˆä»¥è¿å­—ç¬¦ç»“å°¾ï¼‰

**å‰ç«¯éªŒè¯æç¤º**ï¼š
```
Provider ID åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦ï¼Œä¸”ä¸èƒ½ä»¥è¿å­—ç¬¦å¼€å¤´æˆ–ç»“å°¾ã€‚
ä¾‹å¦‚ï¼šgoogle-gemini, openai-proxy, local-ollama
```

---

## åç«¯ API è®¾è®¡

### API ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/v1/settings` | è·å–å…¨éƒ¨è®¾ç½®ï¼ˆå¯†é’¥æ©ç ï¼‰ |
| PUT | `/api/v1/settings` | æ›´æ–°è®¾ç½® |
| POST | `/api/v1/settings/test` | æµ‹è¯• Provider è¿é€šæ€§ |
| GET | `/api/v1/settings/provider-types` | è·å–æ”¯æŒçš„ Provider ç±»å‹åˆ—è¡¨ |

### ç±»å‹å®šä¹‰

```typescript
// æ–°å¢åˆ° docs/API_TYPES.ts

// ==========================================
// Settings Types
// ==========================================

/** æ”¯æŒçš„ Provider ç±»å‹ */
export type ProviderType = 'openai' | 'anthropic' | 'google' | 'ollama';

/** Provider é…ç½® */
export interface ProviderConfig {
  id: string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰
  name: string;                  // æ˜¾ç¤ºåç§°
  type: ProviderType;            // æä¾›å•†ç±»å‹
  api_key: string;               // æ©ç åçš„å¯†é’¥ "AIza****e4U" æˆ– ""
  base_url: string | null;       // è‡ªå®šä¹‰ URL
}

/** Agent é…ç½® */
export interface AgentConfig {
  provider_id: string;           // å¼•ç”¨çš„ Provider ID
  model: string;                 // æ¨¡å‹åç§°
  temperature: number;           // æ¸©åº¦ 0.0-2.0
  max_tokens: number;            // æœ€å¤§ token æ•°
}

/** Agent åç§° */
export type AgentName = 'gm' | 'npc' | 'rule' | 'lore';

/** å…¨éƒ¨ Agent é…ç½® */
export type AgentsConfig = Record<AgentName, AgentConfig>;

/** å®Œæ•´è®¾ç½®å“åº” */
export interface SettingsResponse {
  providers: ProviderConfig[];
  agents: AgentsConfig;
  game: {
    default_language: Language;
    dice: {
      use_advantage_system: boolean;
      show_roll_details: boolean;
    };
  };
}

/** æ›´æ–°è®¾ç½®è¯·æ±‚ */
export interface UpdateSettingsRequest {
  providers?: ProviderConfig[];
  agents?: Partial<AgentsConfig>;
}

/** æµ‹è¯•è¿æ¥è¯·æ±‚ */
export interface TestConnectionRequest {
  provider_id: string;
}

/** æµ‹è¯•è¿æ¥å“åº” */
export interface TestConnectionResponse {
  success: boolean;
  provider_id: string;
  message: string;
  latency_ms?: number;
}

/** Provider ç±»å‹å…ƒä¿¡æ¯ */
export interface ProviderTypeInfo {
  type: ProviderType;
  name: string;                  // "OpenAI", "Anthropic", etc.
  requires_api_key: boolean;     // Ollama = false
  default_base_url: string | null;
  placeholder_models: string[];  // å¸¸ç”¨æ¨¡å‹ç¤ºä¾‹
}

/** Provider ç±»å‹åˆ—è¡¨å“åº” */
export interface ProviderTypesResponse {
  types: ProviderTypeInfo[];
}

/** éªŒè¯é”™è¯¯ */
export interface SettingsValidationError {
  field: string;
  message: string;
}
```

### ä¸šåŠ¡è§„åˆ™

1. **åˆ é™¤ Provider æ—¶**ï¼šå¦‚æœæœ‰ Agent æ­£åœ¨ä½¿ç”¨è¯¥ Providerï¼Œè¿”å› 400 é”™è¯¯ï¼š
   ```json
   {
     "detail": "æ— æ³•åˆ é™¤ Provider 'google-gemini'ï¼šæ­£åœ¨è¢«ä»¥ä¸‹ Agent ä½¿ç”¨: gm, npc, lore"
   }
   ```

2. **Provider ID é‡å¤**ï¼šè¿”å› 400 é”™è¯¯ï¼š
   ```json
   {
     "detail": "Provider ID 'my-provider' å·²å­˜åœ¨"
   }
   ```

3. **Agent å¼•ç”¨ä¸å­˜åœ¨çš„ Provider**ï¼šè¿”å› 400 é”™è¯¯ï¼š
   ```json
   {
     "detail": "Agent 'gm' å¼•ç”¨çš„ Provider 'non-existent' ä¸å­˜åœ¨"
   }
   ```

---

## å‰ç«¯è®¾ç½®é¡µé¢è®¾è®¡

### é¡µé¢ç»“æ„

```
/settings                         # æ–°å¢è®¾ç½®é¡µé¢è·¯ç”±
â”œâ”€â”€ ProvidersSection              # Provider ç®¡ç†åŒºåŸŸ
â”‚   â”œâ”€â”€ ProviderList              # Provider åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ ProviderCard          # å•ä¸ª Provider å¡ç‰‡
â”‚   â””â”€â”€ AddProviderButton         # æ·»åŠ æ–° Provider
â”œâ”€â”€ AgentsSection                 # Agent é…ç½®åŒºåŸŸ
â”‚   â”œâ”€â”€ AgentConfigCard (GM)      
â”‚   â”œâ”€â”€ AgentConfigCard (NPC)     
â”‚   â”œâ”€â”€ AgentConfigCard (Rule)    
â”‚   â””â”€â”€ AgentConfigCard (Lore)    
â””â”€â”€ ActionButtons                 # ä¿å­˜/é‡ç½®æŒ‰é’®
```

### UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ è®¾ç½®                                     [é‡ç½®] [ä¿å­˜]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“¡ AI Providers                             [+ æ·»åŠ  Provider]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Google Gemini                    [æµ‹è¯• âœ“] [ç¼–è¾‘] [åˆ é™¤]  â”‚   â”‚
â”‚  â”‚ ç±»å‹: google | å¯†é’¥: AIza****xxx | URL: é»˜è®¤             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ æœ¬åœ° Ollama                      [æµ‹è¯• âœ“] [ç¼–è¾‘] [åˆ é™¤]  â”‚   â”‚
â”‚  â”‚ ç±»å‹: ollama | å¯†é’¥: æ— éœ€ | URL: http://localhost:11434  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ¤– Agent é…ç½®                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GM Agent (æ ¸å¿ƒå™äº‹)                                      â”‚   â”‚
â”‚  â”‚ Provider: [Google Gemini    â–¼]  Model: [gemini-3-flash]  â”‚   â”‚
â”‚  â”‚ Temperature: [0.7â”â”â”â”â”â”â”â”â”â”â”]   Max Tokens: [2048    ]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ NPC Agent (è§’è‰²æ‰®æ¼”)                                     â”‚   â”‚
â”‚  â”‚ Provider: [Google Gemini    â–¼]  Model: [gemini-3-flash]  â”‚   â”‚
â”‚  â”‚ Temperature: [0.8â”â”â”â”â”â”â”â”â”â”â”]   Max Tokens: [1024    ]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Rule Agent (è§„åˆ™åˆ¤å®š)                                    â”‚   â”‚
â”‚  â”‚ Provider: [æœ¬åœ° Ollama      â–¼]  Model: [llama3       ]   â”‚   â”‚
â”‚  â”‚ Temperature: [0.3â”â”â”â”â”â”â”â”â”â”â”]   Max Tokens: [512     ]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Lore Agent (çŸ¥è¯†æ£€ç´¢)                                    â”‚   â”‚
â”‚  â”‚ Provider: [Google Gemini    â–¼]  Model: [gemini-2.5   ]   â”‚   â”‚
â”‚  â”‚ Temperature: [0.5â”â”â”â”â”â”â”â”â”â”â”]   Max Tokens: [1024    ]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Provider ç¼–è¾‘å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–è¾‘ Provider                          [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ID *                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ google-gemini                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦              â”‚
â”‚                                             â”‚
â”‚  æ˜¾ç¤ºåç§° *                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Google Gemini                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  ç±»å‹ *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Google                           â–¼  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  API Key                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ç•™ç©ºä»¥æ¸…é™¤ï¼Œä¸ä¿®æ”¹è¯·ä¿æŒåŸæ ·                 â”‚
â”‚                                             â”‚
â”‚  Base URL (å¯é€‰)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ç•™ç©ºä½¿ç”¨é»˜è®¤åœ°å€                           â”‚
â”‚                                             â”‚
â”‚              [å–æ¶ˆ]  [ä¿å­˜]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿é€šæ€§æµ‹è¯•æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» [æµ‹è¯•] æŒ‰é’®
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æµ‹è¯•ä¸­...]        â”‚  â† æŒ‰é’®æ˜¾ç¤º loading çŠ¶æ€
â”‚  â³                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
POST /api/v1/settings/test
  { provider_id: "google-gemini" }
       â”‚
       â–¼
åç«¯æ‰§è¡Œç®€å• API è°ƒç”¨ï¼ˆå¦‚å‘é€æµ‹è¯•æ¶ˆæ¯ï¼‰
       â”‚
       â”œâ”€â”€â”€ æˆåŠŸ â”€â”€â†’  âœ… è¿æ¥æˆåŠŸ (å»¶è¿Ÿ: 120ms)
       â”‚
       â””â”€â”€â”€ å¤±è´¥ â”€â”€â†’  âŒ è¿æ¥å¤±è´¥: API å¯†é’¥æ— æ•ˆ
```

---

## å®ç°ä»»åŠ¡æ¸…å•

### Phase 8.1: åç«¯è®¾ç½® API

| # | ä»»åŠ¡ | æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| 1 | é‡æ„ config.py æ”¯æŒæ–°é…ç½®ç»“æ„ | `src/backend/core/config.py` | ğŸ”´ |
| 2 | æ·»åŠ  ProviderConfig / AgentConfig Pydantic æ¨¡å‹ | `src/backend/core/config.py` | ğŸ”´ |
| 3 | æ·»åŠ  Provider ID éªŒè¯å‡½æ•° | `src/backend/core/config.py` | ğŸ”´ |
| 4 | å®ç°è®¾ç½®è¯»å– API GET /api/v1/settings | `src/backend/api/v1/settings.py` | ğŸ”´ |
| 5 | å®ç°è®¾ç½®æ›´æ–° API PUT /api/v1/settings | `src/backend/api/v1/settings.py` | ğŸ”´ |
| 6 | å®ç°è¿é€šæ€§æµ‹è¯• API POST /api/v1/settings/test | `src/backend/api/v1/settings.py` | ğŸ”´ |
| 7 | å®ç° Provider ç±»å‹åˆ—è¡¨ API | `src/backend/api/v1/settings.py` | ğŸŸ¡ |
| 8 | é‡æ„ llm_provider.py æ”¯æŒåŠ¨æ€ Provider | `src/backend/core/llm_provider.py` | ğŸ”´ |
| 9 | æ›´æ–° main.py ä½¿ç”¨æ–°é…ç½®åŠ è½½ Agent | `src/backend/main.py` | ğŸ”´ |
| 10 | ç¼–å†™å•å…ƒæµ‹è¯• | `tests/backend/api/test_settings.py` | ğŸŸ¡ |

### Phase 8.2: å‰ç«¯è®¾ç½®é¡µé¢

| # | ä»»åŠ¡ | æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| 11 | æ·»åŠ è®¾ç½®ç›¸å…³ç±»å‹å®šä¹‰ | `src/web/src/api/types.ts` | ğŸ”´ |
| 12 | æ·»åŠ è®¾ç½® API å®¢æˆ·ç«¯æ–¹æ³• | `src/web/src/api/client.ts` | ğŸ”´ |
| 13 | åˆ›å»º settingsStore | `src/web/src/stores/settingsStore.ts` | ğŸ”´ |
| 14 | åˆ›å»º SettingsPage é¡µé¢ç»„ä»¶ | `src/web/src/pages/SettingsPage.tsx` | ğŸ”´ |
| 15 | åˆ›å»º ProviderCard ç»„ä»¶ | `src/web/src/components/Settings/ProviderCard.tsx` | ğŸ”´ |
| 16 | åˆ›å»º AgentConfigCard ç»„ä»¶ | `src/web/src/components/Settings/AgentConfigCard.tsx` | ğŸ”´ |
| 17 | åˆ›å»º ProviderEditModal å¼¹çª— | `src/web/src/components/Settings/ProviderEditModal.tsx` | ğŸ”´ |
| 18 | æ·»åŠ è·¯ç”± /settings | `src/web/src/App.tsx` | ğŸŸ¡ |
| 19 | åœ¨ Header æ·»åŠ è®¾ç½®å…¥å£ | `src/web/src/components/Layout/Header.tsx` | ğŸŸ¡ |
| 20 | ç¼–å†™å‰ç«¯æµ‹è¯• | `src/web/src/__tests__/settings.test.tsx` | ğŸŸ¡ |

### Phase 8.3: æ–‡æ¡£ä¸è¿ç§»

| # | ä»»åŠ¡ | æ–‡ä»¶ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| 21 | æ›´æ–° API_TYPES.ts æ·»åŠ  Settings ç±»å‹ | `docs/API_TYPES.ts` | ğŸŸ¡ |
| 22 | æ›´æ–° settings.example.yaml ä¸ºæ–°æ ¼å¼ | `config/settings.example.yaml` | ğŸŸ¡ |
| 23 | æ·»åŠ é…ç½®è¿ç§»è„šæœ¬ | `scripts/migrate_settings.py` | ğŸŸ¢ |
| 24 | æ›´æ–° PROGRESS.md | `docs/PROGRESS.md` | ğŸŸ¢ |

---

## æœªæ¥å¼€å‘é¡¹

### Token éªŒè¯ï¼ˆè®¿é—®æ§åˆ¶ï¼‰

> å½“å‰çŠ¶æ€ï¼šçº¯æœ¬åœ°ä½¿ç”¨
> æœªæ¥åœºæ™¯ï¼šå±€åŸŸç½‘è®¿é—®ï¼ˆå¦‚æ‰‹æœºç©æ¸¸æˆï¼‰

è®¡åˆ’å®ç°ç®€å•çš„ Token éªŒè¯æœºåˆ¶ï¼š

1. **é¦–æ¬¡å¯åŠ¨ç”Ÿæˆ Token**ï¼šåç«¯å¯åŠ¨æ—¶ç”Ÿæˆéšæœº Tokenï¼Œä¿å­˜åˆ° `config/auth.yaml`
2. **å‰ç«¯è¯·æ±‚æºå¸¦ Token**ï¼šé€šè¿‡ `Authorization: Bearer <token>` å¤´
3. **åç«¯éªŒè¯**ï¼šä¸­é—´ä»¶éªŒè¯ Tokenï¼Œæ— æ•ˆè¿”å› 401
4. **Token æ˜¾ç¤º**ï¼šåç«¯å¯åŠ¨æ—¶åœ¨æ§åˆ¶å°æ‰“å° Tokenï¼Œæˆ–æä¾› API è·å–

```yaml
# config/auth.yaml (æœªæ¥)
token: "random-generated-token"
enabled: false  # é»˜è®¤å…³é—­ï¼Œç”¨æˆ·å¯é€‰å¼€å¯
```

### å¤šç”¨æˆ·æ”¯æŒ

> é•¿è¿œç›®æ ‡ï¼šæ”¯æŒå¤šäººè”æœº

éœ€è¦å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œè¶…å‡ºå½“å‰èŒƒå›´ã€‚

---

## å‚è€ƒæ–‡æ¡£

- `docs/WEB_FRONTEND_PLAN.md` - å‰ç«¯å¼€å‘è®¡åˆ’
- `docs/ARCHITECTURE.md` - ç³»ç»Ÿæ¶æ„
- `docs/API_TYPES.ts` - API ç±»å‹å®šä¹‰
